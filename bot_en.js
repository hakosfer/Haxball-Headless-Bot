!function(e){let f=e.room=HBInit({roomName:"üëΩ Haxball Room",public:!0,maxPlayers:12,noPlayer:!0});f.setTeamColors(1,60,16777215,[11730944,7208960,3866624]),f.setTeamColors(2,60,16777215,[1079446,809328,606546]),f.setTeamsLock(!0),f.setScoreLimit(3),f.setTimeLimit(5),f.setDefaultStadium("Easy"),f.startGame();let g=e.Bot={config:{adminPass:"aDm123",mapsUrl:""},pa:[],po:{},data:{mode:4,popLimit:0,msg:"",recent:[],nameBL:[],connBL:[],maps:[]}},h=e.Lib={t:null,balance:()=>{var r=g.data.mode;if(-1!==r){let e=Math,a=[[],[],[],[],[]],t,s=g.pa,n,l,i,o;for(t=s.length-1;0<=t;t--)n=s[t],l=n.pref,l.afk||(0===l.team?a[n.team].push(n.id):(a[e.abs(l.team)+2].push(n.id),l.team<0&&(l.team=0)));for(s=a[0],t=s.length-1;0<t;t--)l=e.floor(e.random()*(t+1)),n=s[t],s[t]=s[l],s[l]=n;for(t=s.length-1;0<=t&&(i=a[1].length+a[3].length,o=a[2].length+a[4].length,!(0<r&&i>=r&&o>=r));t--)l=i-o,n=0===l?1+e.floor(2*e.random()):0<l?2:1,a[n].push(s[t]),s.splice(t,1);if(0===r){if(l=a[1].length+a[3].length-a[2].length-a[4].length,l<-1||1<l)for(o=l<0?2:1,s=a[o],l=e.floor(e.abs(l)/2),t=s.length-1;0<=t&&(n=s[t],a[3-o].push(n),s.splice(t,1),l--,0!==l);t--);}else for(t=1;t<3;t++)if(s=a[t],n=s.length+a[t+2].length,n>r)for(n-=r,l=s.length-1;0<=l&&(a[0].push(s[l]),s.splice(l,1),n--,0!==n);l--);for(t=0;t<5;t++)for(n=a[t],l=n.length-1;0<=l;l--)f.setPlayerTeam(n[l],t<3?t:t-2)}},stats:{ks:[],data:[0,0,10,1,700,700*.7,0,0],w:[[0,20,40,30,0,20,10,5,20,-5,-5],[0,20,10,30,0,20,30,40,10,-10,-1]],calc:(e=!1)=>{let a=h.stats,t=a.ks,s=a.data,n=s[1],l,i,o,r,m,d,c=g.po;for(s[0]=1,r=0;r<n-2;r++)l=t[r],i=t[r+1],o=t[r+2],m=c[i[0]],m&&(d=m.log.newStats,i[1]!==l[1]?(i[2]*Math.sign(1.5-i[1])>=s[5]&&d[7]++,i[1]===o[1]&&(d[6]++,i[0]!==o[0]&&(d[4]++,d[5]++))):i[0]!==o[0]&&(d[4]++,i[1]===o[1]&&d[5]++));if(e)for(s[1]=2,l=0;l<2;l++)for(i=0;i<4;i++)t[l][i]=t[n-2+l][i];else s[1]=0;s[0]=0},f:{reset:()=>{h.stats.calc()},init:()=>{let a=f,t=h.stats,s=t.data;if(s[3]){let e=t.f;a.onPlayerBallKick=e.onKick,a.onTeamGoal=e.onGoal,a.onPositionsReset=e.reset,s[0]=0,s[1]=0;var n=s[2];for(t=t.ks,a=0;a<n;a++)for(t[a]=[],t[a].length=4,e=0;e<4;e++)t[a][e]=0}else a.onPlayerBallKick=null,a.onTeamGoal=null,a.onPositionsReset=null},calcScores:e=>{let a=h.stats.w,t=e.log,s=t.aggStats,n=t.aggScores,l=s[0],i,o=a[0].length,r,m;if(!(l<=0))for(r=0;r<2;r++){for(n[r]=0,m=a[r],i=o-1;0<i;i--)n[r]+=s[i]/l*m[i]*10;n[r]=Math.ceil(n[r])}},onKick:t=>{let s=h.stats,n=s.data;if(!n[0]){let e=++n[1],a=s.ks[e-1];a[0]=t.id,a[1]=t.team,a[2]=Date.now(),a[3]=t.position.x,e>=n[2]&&s.calc(!0)}},onGoal:e=>{let a=g.po,t=h,s=t.stats,n=s.ks,l=s.data,i=l[1]-1,o,r=!1,m,d,c="‚öΩ Goal!";return l[0]=1,0===l[4]&&(l[4]=Math.abs(Math.round(f.getBallPosition().x)),l[5]=.7*l[4]),i<0?t.say(c):(m=n[i],0<i&&(d=n[i-1]),m[1]===e?(r=!0,o=a[m[0]]):d&&d[1]===e&&m[2]-d[2]<1e3&&(r=!0,o=a[d[0]],m=d,d=1<i?n[i-2]:null),r||(o=a[m[0]]),o?(c+=" "+o.name+" (",r?(c+="distance: "+Math.ceil(Math.abs(l[4]*Math.sign(1.5-e)-m[3])/14)+"m",o.log.newStats[2]++,o=null,d&&d[1]===e&&d[0]!==m[0]&&(o=a[d[0]]),o&&(c+=", assist: "+o.name,o.log.newStats[3]++)):(o.log.newStats[10]++,c+="own goal"),c+=")",h.say(c)):t.say(c))},victory:n=>{let e=f,a=g.data.mode;if(e.stopGame(),-1===a)return e.startGame();let l=g.pa,i,o,r,t=h,m=t.stats,s=m.data,d=n.red>n.blue?1:2;if(m.calc(),s[5+d]++,s[8-d]=0,t.say("üèÜ "+(1==d?"Red":"Blue")+" team wins! Red "+s[6]+":"+s[7]+" Blue"),(2<s[6]||2<s[7])&&(a=-2,s[6]=0,s[7]=0,t.say("Three-win streak, mixing the teams..")),s[3]){let e,a,t,s=m.f.calcScores;for(i=l.length-1;0<=i;i--){for(o=l[i],a=o.log,r=a.newStats,t=a.aggStats,o.team===d?(r[0]++,r[1]++):o.team===3-d&&r[0]++,1===o.team?(r[8]=n.red,r[9]=n.blue):(r[8]=n.blue,r[9]=n.red),e=0;e<11;e++)t[e]+=r[e],r[e]=0;s(o)}}for(i=l.length-1;0<=i;i--)o=l[i],r=o.pref,r.afk||(-2===a?(r.team=o.team===d?-1-Math.round(Math.random()):r.team,o.team=0,e.setPlayerTeam(o.id,0)):0===a||o.team===3-d?(o.team=0,e.setPlayerTeam(o.id,0)):0===o.team&&(r.team=d-3));t.balance(),e.startGame()}}},fetchMaps:()=>{if(!(g.config.mapsUrl.length<1)){let a=g.data;fetch(g.config.mapsUrl).then(function(e){return e.ok?e.json():Promise.reject({status:e.status,statusText:e.statusText})}).then(function(e){a.maps=e}).catch(e=>{console.log(e)})}},setPW:(e,a=!1)=>{e=!e||e.length<1?null:-1===e?Math.round(1e9*Math.random()).toString(16):e;f.setPassword(e),a&&h.msgAdmins("password"+(null===e?" cleared":": "+e))},nameToPlayer:(e=null)=>{if(null===e||e.length<1)return null;if("#"===e[0])return g.po[parseInt(e.substring(1))];e=e.toLowerCase();let a=g.pa,t,s,n;for(t=a.length-1;0<=t;t--)if(s=a[t],n=s.name.toLowerCase(),n===e)return s;for(t=a.length-1;0<=t;t--)if(s=a[t],n=s.name.toLowerCase(),n.includes(e))return s;return null},mix:e=>{let a,t,s=g.pa;for(a=s.length-1;0<=a;a--)t=s[a],f.setPlayerTeam(t.id,0),t.team=0;h.balance(),e&&e()},mute:(e,a,t=null,s=!0)=>{e.log.mu=Date.now()+6e4*a,s&&h.say("üîï "+e.name+" is "+(0<a?"muted for "+a+" minutes"+(t?" ("+t+")":""):"unmuted"))},say:(e,a)=>{f.sendAnnouncement(e,a,a?10151397:8513796)},msgAdmins:(e,a=1)=>{let t,s,n=g.pa;for(t=n.length-1;0<=t;t--)s=n[t],s.admin>=a&&f.sendAnnouncement(e,s.id,16768768)},ch:{help:{f:(t,s)=>{let n=h,l=n.ch,i;if(s.length)s[0]in l&&(i=l[s[0]],"h"in i&&i.h&&i.a<=t.admin&&n.say(i.h,t.id));else{let e=[],a=Object.keys(l);for(s=0;s<a.length;s++)i=l[a[s]],i.a<=t.admin&&e.push(a[s]);e.length&&n.say("available commands: "+e.join(", "),t.id),n.say("for detailed help, type .help [cmd] or visit https://github.com/uzayyli/Haxball-Headless-Bot",t.id)}},h:null,a:0,c:10},stats:{f:(n,l)=>{let i=h,o=l.length<1?n:i.nameToPlayer(l[0]);if(o){if(2===l.length&&"reset"===l[1]&&(0<n.admin||n.id===o.id))return o.log.stats=[0,0,0,0],l=o.name+"'s stats reset ("+n.name+")",i.say(l,o.id),i.msgAdmins(l);let e=o.log,a=e.aggScores,t=e.aggStats,s=i.say;if(t[0]<1)return s("No saved games",n.id);s(o.name+": Offensive score: "+Math.ceil(a[0])+", Defensive score: "+Math.ceil(a[1]),n.id),s(t[0]+" games, "+t[2]+" goals, "+t[3]+" assists, "+t[7]+" saves, "+t[6]+" steals, "+Math.ceil(t[5]/t[4]*100)+"% pass accuracy, "+Math.ceil(t[1]/t[0]*100)+"% win rate",n.id),s("Per game: "+(t[2]/t[0]).toFixed(1)+" goals, "+(t[3]/t[0]).toFixed(1)+" assists, "+(t[7]/t[0]).toFixed(1)+" saves, "+(t[6]/t[0]).toFixed(1)+" steals, "+(t[5]/t[0]).toFixed(1)+" accurate passes, "+(t[8]/t[0]).toFixed(1)+" team goals scored, "+(t[9]/t[0]).toFixed(1)+" team goals conceded",n.id),t[4]<5&&s("Need at least five games to be in leaderboards",n.id)}},h:"stats ([player]) (reset)",a:0,c:30},top:{f:(e,a)=>{let t=h,s=!1,n,l="aggStats",i=-1,o;if(a.length||(s=!0),!s)switch(n=a[0].toLowerCase().substring(0,4),n){case"atta":l="aggScores",o="Top offensive players (offensive score)",i=0;break;case"defe":l="aggScores",o="Top defensive players (defensive score)",i=1;break;case"goal":o="Top scorers (goals per game)",i=2;break;case"assi":o="Top assisters (assists per game)",i=3;break;case"save":o="Top goalkeepers (saves per game)",i=7;break;default:s=!0}if(s)return e.log.cc=0,t.say("correct usage: "+t.ch.top.h,e.id);for(s=g.pa.map(e=>{var a=e.log,t=a[l],s="aggStats"===l?t[0]:1;return{name:e.name,v:a.aggStats[0]<5||0===s?0:t[i]/s}}).sort((e,a)=>a.v-e.v),l=Math.min(3,s.length),t.say(o+":",e.id),o="",i=0;i<l;i++)o+=s[i].name+" ("+s[i].v.toFixed(2)+")",i<l-1&&(o+=", ");t.say(o,e.id)},h:"top [goals/assists/saves/attackers/defenders]",a:0,c:20},afk:{f:(t,s)=>{if(!(s.length&&t.admin<1)){let e=h,a=0===s.length?t:e.nameToPlayer(s[0]);a&&((t=a.pref).afk=!t.afk,e.say(a.name+" is"+(t.afk?"":" not")+" AFK."),t.team=0,t.afk&&f.setPlayerTeam(a.id,0),e.balance())}},h:"afk ([player])",a:0,c:30},admin:{f:(e,a)=>{let t=e,s=2,n=null;if(a[0]!==g.config.adminPass){if(e.admin<1)return;1<e.admin&&(t=h.nameToPlayer(a[0]),s=parseInt(a[1]),(isNaN(s)||s<0)&&(s=0),n=2<a.length)}null===n&&(n=1<a.length),t.admin=s,h.msgAdmins(t.name+" is "+(0<s?"L"+s+" ":"not ")+(n?"hidden ":"")+"admin ("+e.name+")"),f.setPlayerAdmin(t.id,0<s&&!n)},h:"admin [password] (hidden) or admin [player] [level] (hidden)",a:0,c:20},mute:{f:(e,a)=>{let t=a[0].toLowerCase(),s=Math.min(parseFloat(a[1]),10),n,l=h.mute;if((isNaN(s)||s<0)&&(s=0),"all"===t){let e,a=g.pa;for(e=a.length-1;0<=e;e--)n=a[e],n.a||l(n,s,null,!1);h.say("üîï everyone is "+(0<s?"muted for "+s+" minutes":"unmuted"))}else n=h.nameToPlayer(t),n.a||l(n,s,"admin")},h:"mute [player]/all [minutes]",a:2},avatar:{f:(e,a)=>{let t=a[0],s=a[1][0],n,l,i;if("all"===t)l=g.pa;else{if(l=h.nameToPlayer(t),!l)return;l=[l]}for(t=l.length,n="c"===s?null:"d"===s?"üéÉ":a[1],i=t-1;0<=i;i--)f.setPlayerAvatar(l[i].id,n);1===t&&(l[0].log.av=n)},h:"avatar [player]/all clear/default/[av]",a:2},game:{f:(e,a)=>{let t=h.mix,s=e.name;switch(a[0]){case"mix":t(),s+=" mixed the teams";break;case"remix":f.stopGame(),t(f.startGame),s+=" mixed the teams";break;case"restart":f.stopGame(),f.startGame(),s+=" restarted the game";break;default:s=null}s&&h.say(s)},h:"game mix/remix/restart ([value])",a:1},mode:{f:(e,a)=>{let t=a[0][0].toLowerCase();t="m"===t?-1:"x"===t?0:parseInt(a[0]),t=isNaN(t)?0:t<0?-1:t,g.data.mode=t,h.balance(),h.msgAdmins("Admin mode: "+(-1===t?"manual":0===t?"free for all":t+"v"+t)+" ("+e.name+")")},h:"mode manual/ffa/1v1/2v2/..",a:2},say:{f:(e,a)=>{h.say(a.join(" "))},h:null,a:1},v:{f:(e,a)=>{h.say("v5.4.4c")},h:null,a:0,c:20},m:{f:(e,a)=>{let t=g.data;a.length&&(t.msg=a.join(" ")),h.say(t.msg)},h:"m ([msg])",a:1},pm:{f:(e,a)=>{var t=a.slice(1).join(" "),a=h.nameToPlayer(a[0]);h.say("(PM) "+e.name+": "+t,a.id),h.say("(PM to "+a.name+"): "+t,e.id)},h:"pm [player] [msg]",a:2},blacklist:{f:(e,a)=>{let t=a[0],s=a[1],n=g.data,l;switch(t){case"recent":for(h.say("recent players (oldest first):",e.id),n=n.recent,s=0;s<n.length;s++)t=n[s],h.say('"'+t.name+'": '+t.conn,e.id);l=null;break;case"ip":t=n.connBL,-1===t.indexOf(s)&&t.push(s);var i=n.recent.find(e=>e.conn===s);l=(i?i.name:s)+" ip-blacklisted";break;case"name":n=n.nameBL,-1===n.indexOf(s)&&n.push(s),l=s+" name-blacklisted";break;case"clear":n.nameBL=[],n.connBL=[],l="blacklists cleared";break;case"get":h.msgAdmins("Names: "+n.nameBL.join(", ")),l="IPs:"+n.connBL.join(", ");break;default:h.say("pls "+h.ch.blacklist.h,e.id),l=null}l&&h.msgAdmins(l)},h:"blacklist clear/get/recent/ip/name ([conn/ExactName])",a:2},team:{f:(e,a)=>{let t=a[0],s=a[1][0],n,l,i,o=h,r=!1;if("-"===s&&(r=!0,a[1]=a[1].substring(1),s=a[1][0]),l="r"===s?1:"b"===s?2:"n"===s?0:parseInt(a[1]),(isNaN(l)||l<0||2<l)&&(l=0),"all"===t)s=g.pa,i="Everyone";else{if(s=o.nameToPlayer(t),!s)return;i=s.name,s=[s]}if(o.say(i+" "+(0===l?"removed their team preference":"is "+(r?"moved":"assigned")+" to "+(1===l?"red":"blue")+" team")),r)for(n=s.length-1;0<=n;n--)f.setPlayerTeam(s[n].id,l),s[n].team=l;else{for(n=s.length-1;0<=n;n--)s[n].pref.team=l;o.balance()}},h:"team [player]/all [0/1/2]",a:2},kick:{f:(e,a)=>{var t=h.nameToPlayer(a[0]),a=1<a.length&&0<a[1].length?a.slice(1).join(" "):null;f.kickPlayer(t.id,a,!1)},h:null,a:2},ban:{f:(e,a)=>{var t=h.nameToPlayer(a[0]),a=1<a.length&&0<a[1].length?a.slice(1).join(" "):null;f.kickPlayer(t.id,a,!0)},h:null,a:2},clearbans:{f:()=>{f.clearBans(),h.msgAdmins("bans cleared")}},setpw:{f:(e,a)=>{let t=a[0].substring(0,4);t="rand"===t?-1:"null"===t?null:a[0],h.setPW(t,!0)},h:"setpw [pAsS]/rand/null]",a:2},maps:{f:(e,a)=>{a.length&&1<e.admin&&"fetch"===a[0]?(h.fetchMaps(),h.msgAdmins("maps reloaded")):h.say(Object.keys(g.data.maps).join(", "),e.id)},h:"maps (fetch)",a:1},load:{f:(n,l)=>{if(l.length){let e,a=l[0].toLowerCase(),t=null,s=g.data.maps;for(e in s)if(e.toLowerCase()===a){t=e;break}if(!t)for(e in s)if(e.toLowerCase().includes(a)){t=e;break}t?("object"==typeof s[t]&&(s[t]=JSON.stringify(s[t])),f.stopGame(),f.setCustomStadium(s[t]),f.startGame(),h.msgAdmins(n.name+" loaded "+e)):h.say("no such stadium",n.id)}},h:null,a:1},statsmod:{f:(t,s)=>{if(s.length){let e=s[0].toLowerCase(),a=h;e="on"===e?1:"off"===e?0:parseInt(e),e=isNaN(e)?0:e,a.say(t.name+" turned stats logging "+(e?"on":"off")),a=a.stats,a.data[3]=e,a.f.init()}},h:"statsmod on/off",a:2},poplimit:{f:(e,a)=>{let t=parseInt(a[0]);t=isNaN(t)?0:t,g.data.popLimit=t,h.setPW(t&&g.pa.length>=t?-1:null),h.msgAdmins("pop limit: "+(0===t?"off":t)+" ("+e.name+")")},h:"poplimit [value]",a:2}}};f.onStadiumChange=(e,a)=>{h.stats.data[4]=0},f.onGameStart=e=>{let a=h;clearTimeout(a.t),a=a.stats,a.data[3]&&(a.data[1]=0,a.f.reset())},f.onTeamVictory=e=>{let a=h;a.t=setTimeout(()=>{a.stats.f.victory(e)},3e3)},f.onPlayerTeamChange=(e,a)=>{let t=g.po[e.id];if(a&&t.pref.afk&&0<e.team)return h.say(e.name+" is AFK",a.id),f.setPlayerTeam(e.id,0);t.team=e.team},f.onPlayerAdminChange=(a,e)=>{if(e){let e=g.po[a.id];e.admin=a.admin?Math.max(1,e.admin):0}},f.onPlayerJoin=a=>{let e=g.pa,t=a.name.toLowerCase(),s,n=!1;for(s=e.length-1;0<=s;s--)if(e[s].name.toLowerCase()===t)return f.kickPlayer(a.id,"There is already a player with this name",!1);for(t=g.data,e=t.nameBL,s=e.length-1;0<=s;s--)if(a.name.includes(e[s])){n=!0;break}if(!n)for(e=t.connBL,s=e.length-1;0<=s;s--)if(a.conn===e[s]){n=!0,e.splice(s,1);break}if(n)return f.kickPlayer(a.id,"blacklist",!0);n=Date.now(),t=g.data.recent,s=t.findIndex(e=>e.conn===a.conn),e={id:a.id,name:a.name,team:0,admin:0,pref:{afk:!1,team:0},log:{conn:a.conn,mu:-(n+1e4),lm:n,tc:0,av:null,cc:n,newStats:[0,0,0,0,1,1,0,0,0,0,0],aggScores:[0,0]}},-1===s?(n=null,t=e.log,t.aggStats=[0,0,0,0,0,0,0,0,0,0,0]):(s=t[s],n=s.name,t=e.log,n===a.name&&(n=null),t.av=s.av,s.mu>-t.mu&&(t.mu=s.mu),s.cc>t.cc&&(t.cc=s.cc),t.aggStats=s.aggStats),g.pa.push(e),g.po[e.id]=e,t.av&&f.setPlayerAvatar(e.id,t.av),t=h,t.say("Welcome "+e.name+"!"+(n?" (Previous name: "+n+")":"")),t.say("Type .help to see available commands",e.id),t.balance(),n=g.data.popLimit,n&&g.pa.length>=n&&t.setPW(-1)},f.onPlayerLeave=n=>{if(n=g.po[n.id]){let e=n.log,a={name:n.name,conn:e.conn,av:e.av,mu:e.mu,cc:e.cc,aggStats:e.aggStats},t,s;for(e=g.data.recent,t=e.length-1;0<=t;t--)if(e[t].conn===a.conn){e.splice(t,1);break}for(e.push(a),20<e.length&&e.splice(0,1),s=h,e=g.pa,t=e.length-1;0<=t;t--)if(e[t].id===n.id){e.splice(t,1);break}delete g.po[n.id],s.balance(),a=g.data.popLimit,a&&e.length<a&&s.setPW(null)}},f.onPlayerChat=(a,t)=>{a=g.po[a.id];let s=h,e,n,l,i=Date.now();if(a.admin<1){if(l=a.log,n=l.mu,n<0&&(-n<i?l.mu=0:15<t.length&&(n=-n)),n>i)return s.say("You can chat in "+Math.ceil((n-i)/1e3)+" seconds.",a.id),!1;if(e=i-l.lm,5e3<e)l.tc=0;else if(e<1100&&(l.tc++,2<l.tc))return l.tc=0,s.mute(a,1,"spam"),!1;l.lm=i}if("!"===t[0]||"."===t[0]&&"."!==t[1])try{if(e=t.substring(1).split(" "),n=e[0].toLowerCase(),n=s.ch[n],!n)return!1;if(a.admin<1){if((t=a.log).cc>=i)return s.say("please wait before using commands again",a.id),!1;t.cc=i+1e3*(n.c||5)}return n.a>a.admin?(s.say("you need to be admin level "+n.a+" to use this command",a.id),!1):!!n.f(a,e.slice(1))}catch(e){return 0<a.admin&&(s.msgAdmins(a.name+", an error occured. message: "+t),s.msgAdmins(e.message+" @"+e.lineNumber)),!1}},h.stats.f.init(),h.fetchMaps()}("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this);