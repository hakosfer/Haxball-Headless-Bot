!function(e){let o=e.room=HBInit({roomName:"üëΩ Haxball Room",public:!0,maxPlayers:12,noPlayer:!0});o.setTeamColors(1,60,16777215,[11730944,7208960,3866624]),o.setTeamColors(2,60,16777215,[1079446,809328,606546]),o.setTeamsLock(!0),o.setScoreLimit(3),o.setTimeLimit(5),o.setDefaultStadium("Easy"),o.startGame();let f=e.Bot={config:{adminPass:"aDm123",mapsUrl:""},pa:[],po:{},data:{mode:4,popLimit:0,stats:!0,msg:"",recent:[],nameBL:[],connBL:[],maps:[]}},m=e.Lib={t:null,balance:()=>{var m=f.data.mode;if(-1!==m){let e=[[],[],[],[],[]],a,t=f.pa,n,s,l,i;for(a=t.length-1;0<=a;a--)n=t[a],s=n.pref,s.afk||(0===s.team?e[n.team].push(n.id):(e[Math.abs(s.team)+2].push(n.id),s.team<0&&(s.team=0)));for(t=e[0],a=t.length-1;0<a;a--)s=Math.floor(Math.random()*(a+1)),n=t[a],t[a]=t[s],t[s]=n;for(a=t.length-1;0<=a&&(l=e[1].length+e[3].length,i=e[2].length+e[4].length,!(0<m&&l>=m&&i>=m));a--)s=l-i,n=0===s?1+Math.floor(2*Math.random()):0<s?2:1,e[n].push(t[a]),t.splice(a,1);if(0===m){if(s=e[1].length+e[3].length-e[2].length-e[4].length,s<-1||1<s)for(i=s<0?2:1,t=e[i],s=Math.floor(Math.abs(s)/2),a=t.length-1;0<=a&&(n=t[a],e[3-i].push(n),t.splice(a,1),s--,0!==s);a--);}else for(a=1;a<3;a++)if(t=e[a],n=t.length+e[a+2].length,n>m)for(n-=m,s=t.length-1;0<=s&&(e[0].push(t[s]),t.splice(s,1),n--,0!==n);s--);for(a=0;a<5;a++)for(n=e[a],s=n.length-1;0<=s;s--)o.setPlayerTeam(n[s],a<3?a:a-2)}},stats:{vict:[0,0],kc:[0,0,0,0,0,0,0],kl:[0,0,0,0,0,0,0],reset:()=>{let e=m.stats;e.kc=[0,0,0,0,0,0],e.kl=[0,0,0,0,0,0]},onKick:e=>{let a=m.stats,t=a.kl,n=a.kc;a.kl=n,a.kc=[e.id,e.team,Date.now(),e.position.x,t[0],t[1],t[2]]},onGoal:e=>{let a=m.stats,t="‚öΩ Goal!",n=f.po,s,l,i=!1;return s=a.kc,s[1]===e?(i=!0,l=n[s[0]]):s[5]===e&&500<s[2]-s[6]&&(i=!0,l=n[s[4]]),i||(l=n[s[0]]),l&&(t+=" "+l.name+" (",i?(t+="distance: "+Math.ceil(Math.abs(700*Math.sign(1.5-e)-s[3])/14)+"m",l.log.stats[2]++,s[5]===e&&(l=null,s[4]!==s[0]?l=n[s[4]]:(s=a.kl,s[5]===e&&s[4]!==s[0]&&(l=n[s[4]])),l&&(t+=", assist: "+l.name,l.log.stats[3]++))):t+="own goal",t+=")"),m.say(t)},victory:e=>{o.stopGame();let a=f.data.mode;if(-1===a)return o.startGame();let t=f.pa,n,s,l,i=m.stats.vict;for(i[e-1]++,i[2-e]=0,m.say("üèÜ "+(1===e?"Red":"Blue")+" team wins! Red "+i[0]+":"+i[1]+" Blue"),(2<i[0]||2<i[1])&&(a=-2,i[0]=0,i[1]=0),i=f.data.stats,n=t.length-1;0<=n;n--)s=t[n],l=s.pref,l.afk||(i&&(s.log.stats[0]++,s.team===e&&s.log.stats[1]++),-2===a?(l.team=0===s.team?e-3:l.team,s.team=0,o.setPlayerTeam(s.id,0)):0===a||s.team===3-e?(s.team=0,o.setPlayerTeam(s.id,0)):0===s.team&&(l.team=e-3));m.balance(),o.startGame()}},fetchMaps:()=>{if(!(f.config.mapsUrl.length<1)){let a=f.data;fetch(f.config.mapsUrl).then(function(e){return e.ok?e.json():Promise.reject({status:e.status,statusText:e.statusText})}).then(function(e){a.maps=e}).catch(e=>{console.log(e)})}},setPW:(e,a=!1)=>{e=!e||e.length<1?null:-1===e?Math.round(1e9*Math.random()).toString(16):e;o.setPassword(e),a&&m.msgAdmins("password"+(null===e?" cleared":": "+e))},nameToPlayer:(e=null)=>{if(null===e||e.length<1)return null;if("#"===e[0])return f.po[parseInt(e.substring(1))];e=e.toLowerCase();let a=f.pa,t,n,s;for(t=a.length-1;0<=t;t--)if(n=a[t],s=n.name.toLowerCase(),s===e)return n;for(t=a.length-1;0<=t;t--)if(n=a[t],s=n.name.toLowerCase(),s.includes(e))return n;return null},mix:e=>{let a,t,n=f.pa;for(a=n.length-1;0<=a;a--)t=n[a],o.setPlayerTeam(t.id,0),t.team=0;m.balance(),e&&e()},mute:(e,a,t=null,n=!0)=>{e.log.mu=Date.now()+6e4*a,n&&c.say("üîï "+e.name+" is "+(0<a?"muted for "+a+" minutes"+(t?" ("+t+")":""):"unmuted"))},say:(e,a)=>{o.sendAnnouncement(e,a,a?1686504:8513796)},msgAdmins:(e,a=1)=>{let t,n,s=f.pa;for(t=s.length-1;0<=t;t--)n=s[t],n.admin>=a&&o.sendAnnouncement(e,n.id,16768768)},ch:{help:{f:(t,n)=>{let s=m,l=s.ch,i;if(n.length)n[0]in l&&(i=l[n[0]],"h"in i&&i.h&&i.a<=t.admin&&s.say(i.h,t.id));else{let e=[],a=Object.keys(l);for(n=0;n<a.length;n++)i=l[a[n]],i.a<=t.admin&&e.push(a[n]);e.length&&s.say("commands: "+e.join(", "),t.id),s.say("detailed help: .help [cmd] or https://github.com/uzayyli/Haxball-Headless-Bot",t.id)}},h:null,a:0,c:10},rank:{f:(t,n)=>{let s=n.length<1?t:m.nameToPlayer(n[0]);if(s){if(2===n.length&&0<t.admin&&"reset"===n[1])return s.log.stats=[0,0,0,0],m.msgAdmins(s.name+"'s stats are reset ("+t.name+")");let e=s.log.stats,a=m.say;if(e[0]<1)return a("No saved games",t.id);a(s.name+": "+e[0]+" games, "+e[2]+" goals, "+e[3]+" assists, %"+Math.ceil(e[1]/e[0]*100)+" win rate",t.id),a("Per game: "+(e[2]/e[0]).toFixed(1)+" goals, "+(e[3]/e[0]).toFixed(1)+" assists",t.id)}},h:"rank ([player]) (reset)",a:0,c:20},afk:{f:(e,a)=>{let t=c,n=0===a.length?e:t.nameToPlayer(a[0]);n&&((e=n.pref).afk=!e.afk,t.say(n.name+" is"+(e.afk?"":" not")+" AFK."),e.team=0,e.afk&&r.setPlayerTeam(n.id,0),t.balance())},h:"afk ([player])",a:0,c:30},admin:{f:(e,a)=>{let t=e,n=2,s=null;if(a[0]!==f.config.adminPass){if(e.admin<1)return;1<e.admin&&(t=m.nameToPlayer(a[0]),n=parseInt(a[1]),(isNaN(n)||n<0)&&(n=0),s=2<a.length)}null===s&&(s=1<a.length),m.msgAdmins(t.name+" is "+(0<n?"L"+n+" ":"not ")+(s?"hidden ":"")+"admin ("+e.name+")"),t.admin=n,o.setPlayerAdmin(t.id,0<n&&!s)},h:"admin [password] (hidden) or admin [player] [level] (hidden)",a:0,c:20},mute:{f:(e,a)=>{let t=a[0].toLowerCase(),n=Math.min(parseFloat(a[1]),10),s,l=c.mute;if((isNaN(n)||n<0)&&(n=0),"all"===t){let e,a=d.pa;for(e=a.length-1;0<=e;e--)s=a[e],s.a||l(s,n,null,!1);c.say("üîï everyone is "+(0<n?"muted for "+n+" minutes":"unmuted"))}else s=c.nameToPlayer(t),s.a||l(s,n,"admin")},h:"mute [player]/all [minutes]",a:2},avatar:{f:(e,a)=>{let t=a[0],n=a[1][0],s,l,i;if("all"===t)l=f.pa;else{if(l=m.nameToPlayer(t),!l)return;l=[l]}for(t=l.length,s="c"===n?null:"d"===n?"üéÉ":a[1],i=t-1;0<=i;i--)o.setPlayerAvatar(l[i].id,s);1===t&&(l[0].log.av=s)},h:"avatar [player]/all clear/default/[av]",a:2},game:{f:(e,a)=>{let t=m.mix,n=e.name;switch(a[0]){case"mix":t(),n+=" mixed the teams";break;case"remix":o.stopGame(),t(o.startGame),n+=" mixed the teams";break;case"restart":o.stopGame(),o.startGame(),n+=" restarted the game";break;default:n=null}n&&m.say(n)},h:"game mix/remix/restart ([value])",a:1},mode:{f:(e,a)=>{let t=a[0][0].toLowerCase();t="m"===t?-1:"x"===t?0:parseInt(a[0]),t=isNaN(t)?0:t<0?-1:t,f.data.mode=t,m.balance(),m.msgAdmins("Game mode: "+(-1===t?"manual":0===t?"free for all":t+"v"+t)+" ("+e.name+")")},h:"mode manual/ffa/1v1/2v2/..",a:2},say:{f:(e,a)=>{m.say(a.join(" "))},h:null,a:1},v:{f:(e,a)=>{m.say("v5.4.3")},h:null,a:0,c:20},m:{f:(e,a)=>{let t=f.data;a.length&&(t.msg=a.join(" ")),m.say(t.msg)},h:"m ([msg])",a:1},pm:{f:(e,a)=>{var t=a.slice(1).join(" "),a=m.nameToPlayer(a[0]);m.say("(PM) "+e.name+": "+t,a.id),m.say("(PM to "+a.name+"): "+t,e.id)},h:"pm [player] [msg]",a:2},blacklist:{f:(e,a)=>{let t=a[0],n=a[1],s=f.data,l;switch(t){case"recent":for(m.say("recent players (oldest first):",e.id),s=s.recent,n=0;n<s.length;n++)t=s[n],m.say('"'+t.name+'": '+t.conn,e.id);l=null;break;case"ip":t=s.connBL,-1===t.indexOf(n)&&t.push(n);var i=s.recent.find(e=>e.conn===n);l=(i?i.name:n)+" ip-blacklisted";break;case"name":s=s.nameBL,-1===s.indexOf(n)&&s.push(n),l=n+" name-blacklisted";break;case"clear":s.nameBL=[],s.connBL=[],l="blacklists cleared";break;case"get":m.msgAdmins("Blacklists:"),m.msgAdmins("Names: "+s.nameBL.join(", ")),l="IPs:"+s.connBL.join(", ");break;default:m.say("pls "+m.ch.blacklist.h,e.id),l=null}l&&m.msgAdmins(l)},h:"blacklist clear/get/recent/ip/name ([conn/ExactName])",a:2},team:{f:(e,a)=>{let t=a[0],n=a[1][0],s,l,i,m=c,o=!1;if("-"===n&&(o=!0,a[1]=a[1].substring(1),n=a[1][0]),l="r"===n?1:"b"===n?2:"n"===n?0:parseInt(a[1]),(isNaN(l)||l<0||2<l)&&(l=0),"all"===t)n=d.pa,i="Everyone";else{if(n=m.nameToPlayer(t),!n)return;i=n.name,n=[n]}if(m.say(i+" "+(0===l?"removed their team preference":"is "+(o?"moved":"assigned")+" to "+(1===l?"red":"blue")+" team")),o)for(s=n.length-1;0<=s;s--)r.setPlayerTeam(n[s].id,l),n[s].team=l;else{for(s=n.length-1;0<=s;s--)n[s].pref.team=l;m.balance()}},h:"team [player/all] [0/1/2]",a:2},kick:{f:(e,a)=>{var t=m.nameToPlayer(a[0]),a=1<a.length&&0<a[1].length?a.slice(1).join(" "):null;o.kickPlayer(t.id,a,!1)},h:null,a:2},ban:{f:(e,a)=>{var t=m.nameToPlayer(a[0]),a=1<a.length&&0<a[1].length?a.slice(1).join(" "):null;o.kickPlayer(t.id,a,!0)},h:null,a:2},setpw:{f:(e,a)=>{let t=a[0].substring(0,4);t="rand"===t?-1:"null"===t?null:a[0],m.setPW(t,!0)},h:"setpw [pAsS]/rand/null]",a:2},maps:{f:(e,a)=>{a.length&&1<e.admin&&"fetch"===a[0]?(m.fetchMaps(),m.msgAdmins("maps reloaded")):m.say(Object.keys(f.data.maps).join(", "),e.id)},h:"maps (fetch)",a:1},load:{f:(s,l)=>{if(l.length){let e,a=l[0].toLowerCase(),t=null,n=f.data.maps;for(e in n)if(e.toLowerCase()===a){t=e;break}if(!t)for(e in n)if(e.toLowerCase().includes(a)){t=e;break}t?("object"==typeof n[t]&&(n[t]=JSON.stringify(n[t])),o.stopGame(),o.setCustomStadium(n[t]),o.startGame(),m.msgAdmins(s.name+" loaded "+e)):m.say("no such stadium",s.id)}},h:null,a:1},stats:{f:(t,n)=>{if(n.length){let e=n[0].toLowerCase(),a=m.stats;e="on"===e?1:"off"===e?0:parseInt(e),e=isNaN(e)?0:e,e=1===e,m.say(t.name+" turned statistics "+(e?"on":"off")),o.onPlayerBallKick=e?a.onKick:null,o.onTeamGoal=e?a.onGoal:null,o.onPositionsReset=e?a.reset:null,o.stopGame(),o.startGame()}},h:"stats on/off",a:2},poplimit:{f:(e,a)=>{let t=parseInt(a[0]);t=isNaN(t)?0:t,f.data.popLimit=t,m.setPW(t&&f.pa.length>=t?-1:null),m.msgAdmins("pop limit: "+(0===t?"off":t)+" ("+e.name+")")},h:"poplimit [value]",a:2}}};o.onGameStart=e=>{let a=m;clearTimeout(a.t),f.data.stats&&a.stats.reset()},o.onTeamVictory=e=>{let a=m;a.t=setTimeout(()=>{a.stats.victory(e.red>e.blue?1:2)},3e3)},o.onPlayerTeamChange=(e,a)=>{let t=f.po[e.id];if(a&&t.pref.afk&&0<e.team)return m.say(e.name+" is AFK",a.id),o.setPlayerTeam(e.id,0);t.team=e.team},o.onPlayerAdminChange=(a,e)=>{if(e){let e=f.po[a.id];e.admin=a.admin?Math.max(1,e.admin):0}},o.onPlayerJoin=a=>{let e=f.pa,t=a.name.toLowerCase(),n,s=!1;for(n=e.length-1;0<=n;n--)if(e[n].name.toLowerCase()===t)return o.kickPlayer(a.id,"There is already a player with this name",!1);for(t=f.data,e=t.nameBL,n=e.length-1;0<=n;n--)if(a.name.includes(e[n])){s=!0;break}if(!s)for(e=t.connBL,n=e.length-1;0<=n;n--)if(a.conn===e[n]){s=!0,e.splice(n,1);break}if(s)return o.kickPlayer(a.id,"blacklist",!0);s=Date.now(),t=f.data.recent,n=t.findIndex(e=>e.conn===a.conn),e={id:a.id,name:a.name,team:0,admin:0,pref:{afk:!1,team:0},log:{conn:a.conn,mu:-(s+1e4),lm:s,tc:0,av:null,cc:s,stats:[0,0,0,0]}},-1===n?(s=null,t=e.log):(n=t[n],s=n.name,t=e.log,s===a.name&&(s=null),t.av=n.av,n.mu>-t.mu&&(t.mu=n.mu),t.stats=n.stats),f.pa.push(e),f.po[e.id]=e,t.av&&o.setPlayerAvatar(e.id,t.av),t=m,t.say("Welcome "+e.name+"!"+(s?" (Previous name: "+s+")":"")),t.balance(),s=f.data.popLimit,s&&f.pa.length>=s&&t.setPW(-1)},o.onPlayerLeave=s=>{if(s=f.po[s.id]){let e=s.log,a={name:s.name,conn:e.conn,av:e.av,mu:e.mu,cc:e.cc,stats:e.stats},t,n;for(e=f.data.recent,t=e.length-1;0<=t;t--)if(e[t].conn===a.conn){e.splice(t,1);break}for(e.push(a),20<e.length&&e.splice(0,1),n=m,e=f.pa,t=e.length-1;0<=t;t--)if(e[t].id===s.id){e.splice(t,1);break}delete f.po[s.id],n.balance(),a=f.data.popLimit,a&&e.length<a&&n.setPW(null)}},o.onPlayerChat=(a,t)=>{a=f.po[a.id];let n=m,e,s,l,i=Date.now();if(a.admin<1){if(l=a.log,s=l.mu,s<0&&(-s<i?l.mu=0:15<t.length&&(s=-s)),s>i)return n.say("You can chat in "+Math.ceil((s-i)/1e3)+" seconds.",a.id),!1;if(e=i-l.lm,5e3<e)l.tc=0;else if(e<1100&&(l.tc++,2<l.tc))return l.tc=0,n.mute(a,1,"spam"),!1;l.lm=i}if("!"===t[0]||"."===t[0]&&"."!==t[1])try{if(e=t.substring(1).split(" "),s=e[0].toLowerCase(),s=n.ch[s],!s)return!1;if(a.admin<1){if((t=a.log).cc>=i)return n.say("Please wait for a while before using commands",a.id),!1;t.cc=i+1e3*(s.c||5)}return s.a>a.admin?(n.say("You need to be admin level "+s.a+" to use this command",a.id),!1):!!s.f(a,e.slice(1))}catch(e){return 0<a.admin&&(n.msgAdmins(a.name+", an error occurred. message: "+t),n.msgAdmins(e.message+" @"+e.lineNumber)),!1}},m.fetchMaps(),f.data.stats&&(e=m.stats,o.onPlayerBallKick=e.onKick,o.onTeamGoal=e.onGoal,o.onPositionsReset=e.reset)}("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this);